{"resolvedId":"E:/Project/www/wwwroot/vite/project-shangpinhui/src/router/index.ts","transforms":[{"name":"__load__","result":"import { createRouter, createWebHistory } from 'vue-router'\nimport { routes } from './routes'\nimport pinia from '@/stores/store'\nimport { useUserStore } from '@/stores/user'\n\n//* pinia\nconst userStore = useUserStore(pinia)\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes,\n  // 滚动行为\n  scrollBehavior(to, from, savedPosition) {\n    // 始终滚动到顶部\n    return { top: 0 }\n  },\n})\n\n// 全局守卫：前置守卫（在路由跳转之前判断 ）\nrouter.beforeEach(async (to) => {\n  //to:可以获取到你要跳转到那个路由的信息\n  //from:可以获取到你从哪个路由而来的信息\n  //next:放行函数 next()放行 next(path)放行到指定路由\n\n  if (userStore.token) {\n    if (to.path === '/login' || to.path === '/register') {\n      return '/'\n    } else {\n      if (!userStore.userInfo.id) {\n        // 没有用户信息\n        try {\n          // 获取用户信息 再 放行跳转路由\n          await userStore.getUserInfo()\n        } catch (e: any) {\n          // token过期，获取信息失败，这个要取决于后端的设计\n          // 清空token等数据\n          // 跳转到登录页面\n          await userStore.userLogout()\n          return '/'\n        }\n      }\n    }\n  }\n\n  // if (userStore.token) {\n  //   // 用户已经登录了，还想去login，两个字：休想，停留在首页\n  //   if (to.path === '/login') {\n  //     next('/')\n  //   } else {\n  //     if (userStore.userInfo.id) {\n  //       next()\n  //     } else {\n  //       // 没有用户信息\n  //       try {\n  //         // 获取用户信息 再 放行跳转路由\n  //         await userStore.getUserInfo()\n  //         // 成功获取用户信息，放行\n  //         next()\n  //       } catch (e: any) {\n  //         // token过期，获取信息失败，这个要取决于后端的设计\n  //         // 清空token等数据\n  //         // 跳转到登录页面\n  //         await userStore.userLogout()\n  //         next('/')\n  //       }\n  //     }\n  //   }\n  // } else {\n  //   //* 未登录还有很多情况，暂时不处理，后期再处理\n  //   next()\n  // }\n})\n\nexport default router\n","start":1663399017219,"end":1663399017219},{"name":"vite:esbuild","result":"import { createRouter, createWebHistory } from \"vue-router\";\nimport { routes } from \"./routes\";\nimport pinia from \"@/stores/store\";\nimport { useUserStore } from \"@/stores/user\";\nconst userStore = useUserStore(pinia);\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes,\n  scrollBehavior(to, from, savedPosition) {\n    return { top: 0 };\n  }\n});\nrouter.beforeEach(async (to) => {\n  if (userStore.token) {\n    if (to.path === \"/login\" || to.path === \"/register\") {\n      return \"/\";\n    } else {\n      if (!userStore.userInfo.id) {\n        try {\n          await userStore.getUserInfo();\n        } catch (e) {\n          await userStore.userLogout();\n          return \"/\";\n        }\n      }\n    }\n  }\n});\nexport default router;\n","start":1663399017219,"end":1663399017243,"order":"normal"},{"name":"vite:import-analysis","result":"import.meta.env = {\"BASE_URL\":\"/\",\"MODE\":\"development\",\"DEV\":true,\"PROD\":false,\"SSR\":false};import { createRouter, createWebHistory } from \"/node_modules/.vite/deps/vue-router.js?v=a7e311b8\";\nimport { routes } from \"/src/router/routes.ts\";\nimport pinia from \"/src/stores/store.ts\";\nimport { useUserStore } from \"/src/stores/user.ts\";\nconst userStore = useUserStore(pinia);\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes,\n  scrollBehavior(to, from, savedPosition) {\n    return { top: 0 };\n  }\n});\nrouter.beforeEach(async (to) => {\n  if (userStore.token) {\n    if (to.path === \"/login\" || to.path === \"/register\") {\n      return \"/\";\n    } else {\n      if (!userStore.userInfo.id) {\n        try {\n          await userStore.getUserInfo();\n        } catch (e) {\n          await userStore.userLogout();\n          return \"/\";\n        }\n      }\n    }\n  }\n});\nexport default router;\n","start":1663399017244,"end":1663399017259,"order":"normal"}]}
